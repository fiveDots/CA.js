function Format(){var a=this;this.aliveValue=2,this.deadValue=0,this.plaintextAlive="O",this.plaintextDead=".",this.plaintextComment="!",this.plaintext=function(b){for(var c=[],d=b.split("\n"),e=0;e<d.legth;e++){line=d[e];for(var f=[],g=0;g<line.length&&line[g]!=a.plaintextComment;g++)f.push(line[g]==a.plaintextAlive?a.aliveValue:a.deadValue);c.push(f)}return c}}var CA=CA||{};CA.Model=function(a,b){var c=this;this.matrixWidth=a,this.matrixHeight=b,this.neighborhoodRadius=1,this.torusNeighborhood=!0,this.matrix=new Array(b);for(var d=0;b>d;d++){this.matrix[d]=new Array(a);for(var e=0;a>e;e++)this.matrix[d][e]=0}this.xCenter=Math.floor(this.matrix.length/2),this.yCenter=Math.floor(this.matrix[0].length/2),this.currentGeneration=0,this.nextState=function(a,b){},this.init=function(){},this.preStep=function(){},this.postStep=function(a){},this.step=function(){c.preStep();for(var a=[],b=new Array(c.matrixHeight),d=0;d<c.matrixHeight;d++){b[d]=new Array(c.matrixWidth);for(var e=0;e<c.matrixWidth;e++)b[d][e]=c.nextState(d,e),b[d][e]!=c.matrix[d][e]&&a.push([d,e,b[d][e]])}return c.postStep(b),c.matrix=b,c.currentGeneration++,a},this.inMatrix=function(a,b){return a>=0&&a<c.matrixHeight&&b>=0&&b<c.matrixWidth},this.allInMatrix=function(a){for(var b=!0,d=0;d<a.length;d++)b=b&&c.inMatrix(a[d][0],a[d][1]);return b},this.getNeighborsInState=function(a,b,d){return c.torusNeighborhood?c.getTorusNeighborsInState(a,b,d):c.getMatrixNeighborsInState(a,b,d)},this.getMatrixNeighborsInState=function(){for(var a=[],b=-c.neighborhoodRadius;b<=c.neighborhoodRadius;b++)for(var d=-c.neighborhoodRadius;d<=c.neighborhoodRadius;d++)(0!=b||0!=d)&&c.inMatrix(x-b,y-d)&&c.matrix[x-b][y-d]==state&&a.push([x-b,y-d]);return a},this.getTorusNeighborsInState=function(a,b,d){for(var e=[],g=-c.neighborhoodRadius;g<=c.neighborhoodRadius;g++)for(var h=-c.neighborhoodRadius;h<=c.neighborhoodRadius;h++)if(0!=g||0!=h){var i=f(a-g,c.matrixHeight),j=f(b-h,c.matrixWidth);c.matrix[i][j]==d&&e.push([i,j])}return e},this.getNeighbors=function(a,b){for(var d=[],e=-c.neighborhoodRadius;e<=c.neighborhoodRadius;e++)for(var f=-c.neighborhoodRadius;f<=c.neighborhoodRadius;f++)(0!=e||0!=f)&&c.inMatrix(a-e,b-f)&&d.push([a-e,b-f]);return d},this.getTorusNeighbors=function(a,b){for(var d=[],e=-c.neighborhoodRadius;e<=c.neighborhoodRadius;e++)for(var g=-c.neighborhoodRadius;g<=c.neighborhoodRadius;g++)if(0!=e||0!=g){var h=f(a-e,c.matrixHeight),i=f(b-g,c.matrixWidth);d.push([h,i])}return d},this.setMatrix=function(a){for(var b=0;b<c.matrix.length;b++)for(var d=0;d<c.matrix[0].length;d++)c.matrix[b][d]=a},this.setRectangle=function(a,b,c,d,e){for(var f=0;d>f;f++)for(var g=0;c>g;g++)setValue(a+f,b+g,e)},this.setPattern=function(a,b,d){for(var e=0;e<d.length;e++)for(var f=0;f<d[e].length;f++)c.setValue(a+e,b+f,d[e][f])},this.randomizeMatrix=function(a){for(var b=1;b<a.length;b++)a[b]+=a[b-1];for(var b=0;b<c.matrixHeight;b++)for(var d=0;d<c.matrixWidth;d++){var e=Math.random();if(e<a[0])c.matrix[b][d]=0;else for(var f=1;f<a.length;f++)if(a[f-1]<=e&&e<a[f]){c.matrix[b][d]=f;break}}},this.uniformlyRandomizeMatrix=function(a){var b=[];b[0]=1/a;for(var d=1;a>d;d++)b.push(b[0]*(d+1));for(var d=0;d<c.matrix.length;d++)for(var e=0;e<c.matrix[0].length;e++){var f=Math.random();if(f<b[0])c.matrix[d][e]=0;else for(var g=1;a>g;g++)if(b[g-1]<=f&&f<b[g]){c.matrix[d][e]=g;break}}},this.getTorusFirstCoordinate=function(a){return f(a,c.matrixHeight)},this.getTorusSecondCoordinate=function(a){return f(a,c.matrixWidth)},this.setValue=function(a,b,d){if(c.getTorusNeighbors){var e=c.getTorusFirstCoordinate(a),f=c.getTorusSecondCoordinate(b);c.matrix[e][f]=d}else c.inMatrix(a,b)&&(c.matrix[a][b]=d)};var f=function(a,b){return(a%b+b)%b}};var CA=CA||{};CA.Painter=function(a,b,c){var d=this;this.colors=a,this.cellLength=b;var e=document.getElementById(c);this.ctx=e.getContext("2d"),this.canvasWidth=e.offsetWidth,this.canvasHeight=e.offsetHeight,this.paintGrid=function(c){for(var e=Math.floor(d.canvasWidth/d.cellLength)+1,f=Math.floor(d.canvasHeight/d.cellLength)+1,g=Math.min(e,c[0].length),h=Math.min(f,c.length),i=-1,j=0;h>j;j++)for(var k=0;g>k;k++){var l=c[j][k];i!=l&&(d.ctx.fillStyle="rgb("+a[l][0]+","+a[l][1]+","+a[l][2]+")",i=l),d.ctx.fillRect(k*b,j*b,b,b)}},this.paintCells=function(c){for(var e=-1,f=0;f<c.length;f++){var g=c[f],h=g[2];e!=h&&(d.ctx.fillStyle="rgb("+a[h][0]+","+a[h][1]+","+a[h][2]+")",e=h),d.ctx.fillRect(g[1]*b,g[0]*b,b,b)}}};var CA=CA||{};CA.Prefabs=function(a){var b=this;this.model=a,this.gameOfLife=function(){var c=b.gameOfLife;b.model.nextState=function(b,c){var d=a.getNeighborsInState(b,c,2).length;return 0==a.matrix[b][c]||1==a.matrix[b][c]?3==d?2:0:d>=2&3>=d?2:1},b.model.init=function(){a.randomizeMatrix([.8,0,.2])},c.getColors=function(){var a=[];return a.push([255,255,255]),a.push([192,192,192]),a.push([0,0,0]),a},b.model.init()},this.coral=function(){b.model.nextState=function(b,c){var d=a.getNeighborsInState(b,c,2).length;return 0==a.matrix[b][c]||1==a.matrix[b][c]?3==d?2:0:d>=4&8>=d?2:1},b.model.init=function(){a.randomizeMatrix([.8,0,.2])},b.model.init()},this.gnarl=function(){var c=b.gnarl;b.model.nextState=function(b,c){var d=a.getNeighborsInState(b,c,2).length;return 0==a.matrix[b][c]||1==a.matrix[b][c]?1==d?2:0:1==d?2:1},b.model.init=function(){a.setMatrix(0),center_x=Math.floor(a.matrix.length/2),center_y=Math.floor(a.matrix[0].length/2),a.matrix[center_x][center_y]=2},c.getColors=function(){var a=[];return a.push([255,255,255]),a.push([192,192,192]),a.push([0,0,0]),a},b.model.init()},this.rug=function(){var c=b.rug;b.model.nextState=function(b,c){for(var d=a.getNeighbors(b,c),e=0,f=0;f<d.length;f++)e+=a.matrix[d[f][0]][d[f][1]];return e/=8,e=Math.floor(e),e++,e%256},b.model.init=function(){a.setMatrix(0),center_x=Math.floor(a.matrix.length/2),center_y=Math.floor(a.matrix[0].length/2),a.setRectangle(center_x,center_y,50,50,255)},c.getColors=function(){for(var a=[],b=255;b>=0;b--)a.push([3*b%256,5*b%256,7*b%256]);return a},c.getGrayscale=function(){for(var a=[],b=255;b>=0;b--)a.push([8*b%256,8*b%256,8*b%256]);return a},b.model.init()},this.landRush=function(){b.lifeRule([3,5],[2,3,4,5,7,8])},this.wolfram1DRule=function(b){for(var d=([[1,1,1],[1,1,0],[1,0,1],[1,0,0],[0,1,1][0],[0,0,1],[0,0,0]],[]),e=0;8>e;e++){var f=1<<e;(b&f)>0?d.push(1):d.push(0)}a.nextState=function(b,c){var e=a.matrix[b][c];if(a.currentGeneration==b){if(0==e){if(a.allInMatrix([[b-1,c],[b-1,c-1],[b-1,c+1]])){for(var f=0,g=-1;1>=g;g++)f|=a.matrix[b-1][c+g],f<<=1;return f>>=1,d[f]}return 0}return 1}return e},a.init=function(){a.matrix[0][a.yCenter]=1},a.init()},this.lifeRule=function(c,d){var e=b.lifeRule;b.model.nextState=function(b,e){var f=a.getNeighborsInState(b,e,2).length;if(0==a.matrix[b][e]||1==a.matrix[b][e]){for(var g=0;g<c.length;g++)if(c[g]==f)return 2;return 0}for(var g=0;g<d.length;g++)if(d[g]==f)return 2;return 1},b.model.init=function(){a.randomizeMatrix([.9,0,.1])},b.model.init(),e.getColors=function(){var a=[];return a.push([255,255,255]),a.push([192,192,192]),a.push([0,0,0]),a}},this.generationsRule=function(c,d,e){var f=b.generationsRule;b.model.nextState=function(b,f){var g=a.getNeighborsInState(b,f,1).length;if(0==a.matrix[b][f]){for(var h=0;h<c.length;h++)if(c[h]==g)return 1;return 0}if(1==a.matrix[b][f]){for(var h=0;h<d.length;h++)if(d[h]==g)return 1;return 2}var i=a.matrix[b][f];return e-1>i?i+1:0},b.model.init=function(){a.randomizeMatrix([.8,.2])},b.model.init(),f.getColors=function(){var a=new Array(e);return a[0]=[0,0,0],b.putColorRange(a,1,e-1,[255,0,0],[255,255,0]),a}},this.transers=function(){var a=b.transersII;prefabs.generationsRule([2,6],[3,4,5],5),a.getColors=function(){return b.generationsRule.getColors()}},this.transersII=function(){var a=b.transersII;b.generationsRule([2,6],[0,3,4,5],6),a.getColors=function(){return b.generationsRule.getColors()}},this.getColorRange=function(a,b,d){for(var e=[],f=0;3>f;f++)e[f]=(b[f]-a[f])/d,e[f]=Math.floor(e[f]);for(var g=[a],f=1;d>f;f++){g[f]=[];for(var h=0;3>h;h++){var i=g[f-1][h]+e[h];g[f].push(c(i,256))}}return g},this.putColorRange=function(a,c,d,e,f){for(var g=b.getColorRange(e,f,d-c+1),h=0;h<g.length;h++)a[c+h]=g[h];return a};var c=function(a,b){return(a%b+b)%b}};